# **Chapter1 Apache Airflow 살펴보기**

## **1.1 데이터 파이프라인 소개**

> ### 데이터 파이프라인
- 파이프라인의 구성
    - 원하는 결과를 얻기 위해 실행되는 여러 태스크 혹은 동작으로 구성한다.
    - 각 태스크들은 **정해진 순서대로** 진행되어야 한다.
    - 정해진 순서의 정확한 표현을 위해 **그래프** 로 표현한다.
> ### 데이터파이프라인 그래프
- 태스크 간의 의존성을 그래프로 표현한다.
    - 태스크 : 노드
    - 의존성 : 화살표<br>
    ➡️ 방향성을 가지는 **방향성 그래프**라고 하며, 정해진 순서를 명확하게 표현할 수 있다<br>
        특히 순환하지 않는 경우 **방향성 비순환 그래프(DAG)**라고 부른다.

- DAG으로 표현하지 않는경우, 교착상태로 이어지며, 그래프가 제대로 동작하지 않게 된다.



> ### 파이프라인 그래프의 실행

< 파이프라인 실행을 위한 알고리즘 로직 > 

    1. 그래프 안의 태스크는 미완료된 상태이며, 다음 세부단계 수행
        1) 다음 태스크로 향하기 전에 이전태스크가 완료 되었는지 확인
        2) 태스크가 완료되면 다음에 실행해야 할 태스크를 대기열에 추가

    2. 실행 대기열에 있는 태스크를 실행하고 태스크 수행이 완료되면 완료표시를 한다.
    3. 그래프의 모든 태스크가 완료될때까지 1번단계로 돌아간다. 

 
> ### 그래프파이프라인 vs 스크립트 파이프라인
- 그래프 파이프라인 : 
    - 태스크와 태스크 사이의 의존성을 직관적으로 표현
    - 태스크를 병렬로 실행할 수 있어 컴퓨팅 리소스를 효율적으로 사용 가능
    - 점진적인 태스크로 명확하게 분리 가능 (실패한 태스크만 재실항 가능)

- 스크립트 파이프라인 
    - 선형 형태로 실행
    - 전체 작업을 하나의 모놀리식으로 구성
    - 중간태스크 실패 시 전체 스크립트 재실행해야하는 문제 발생

> ### 워크플로 매니저를 이용한 파이프라인
![alt text](image.png)


## **1.2 Airflow 소개**

> ### Airflow 특징
- 파이썬으로 작성한 DAG파일
    - DAG파일을 정의하므로써, 태스크 집합, 의존성 등을 기술한다.
    - DAG 구조 식별을 위해 코드를 파싱한다.
    - 실행 방법, 시간, 추가 메타데이터 등을 정의한다.

- DAG파일의 장점
    -  프로그래밍 접근 방식으로 유연성을 제공해준다.
    - 다양한 시스템에서 태스크를 실행할 수 있도록 확정 기능이 개발된다.
    - 복잡한 데이터 파이프라인 구축이 가능하다.

> ### Airflow 구성요소
- Airflow 스케쥴러 : DAG분석, DAG스케쥴에 따라 워커에 DAG 태스크를 예약
- Airflow 워커 : 예약된 태스크를 선택하고 실행
- Airflow 웹서버 : 스케줄러에서 분석한 DAG을 시각화, DAG실행 결과를 출력



> ### Airflow 스케줄러의 작업단계

1. 사용자가 DAG 워크플로를 작성하면, DAG파일을 분석하고, 각 DAG 태스크, 의존성 및 예약 주기 확인
2. 마지막 DAG까지 내용 확인 후, 예약 주기가 경과 했는지 확인.(예약주기가 현재이전이면 예약)
3. 예약된 각 태스크에 대해 스케줄러는 의존성을 확인하고, 미완료 시 실행 대기열에 추가
4. 1단계로 돌아가 새로운 루프를 잠시 동안 대기
![alt text](image-1.png)


> ### 모니터링과 실패 처리
 - 웹서버를 통해 DAG을확인하고 실행결과에 대해 모니터링한다.

> ### 점신적 로딩 및 백필
 - 특정 시점에 트리거 가능
 - 주기별 DAG실행 (점진적 실행 가능)
 - 백필 : 새로 생성한 DAG을 과거 시점 및 기간에 대해 실행이 가능하다


## **1.3 언제 Airflow를 사용해야할까?**

> ### 적합한 CASE
- 파이썬을 이용해 복잡한 커스텀 파이프라인 구축 시
- 다양한 유형의 시스템과 통합을 해야하는 상황일 때
- 점진적 증분 처리를 통해 전체 재실행을 할 필요 없는 효율적인 파이프라인 구축을 위해
- 백필 기능이 필요할 때
- 웹을 이용해 모니터링하고 웹인터페이스 활용이 필요할때

> ### 부적합한 CASE
- 스트리밍 워크플로
- 추가 및 삭제가 빈번한 동적 파이프라인
- 파이썬 경험이 전혀 없는 경우
- 파이프라인에 대해 느슨한 관리를 하는 경우

## **1.4 이후 내용**
- Airflow 기본적인 구성요소 소개
- 동적 DAG 생성, 커스텀 오퍼레이터 구현, 컨테이너화된 태스크 실행
- 배포 패턴, 모니터링, 보안, 클라우드 아키텍처 등


